<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Gidon Cohen" />

<meta name="date" content="2018-11-26" />

<title>Article Classification Process Incorporating Machine Learning</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Article Classification Process Incorporating Machine Learning</h1>
<h4 class="author"><em>Gidon Cohen</em></h4>
<h4 class="date"><em>2018-11-26</em></h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This vignette covers the process of article classification using machine learning.</p>
</div>
<div id="obtain-classified-and-unclassified-document-sets-and-relate-to-systematic-searches" class="section level2">
<h2>Obtain Classified and Unclassified Document Sets and Relate to Systematic Searches</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">

alldocs&lt;-<span class="kw">get_document</span>(<span class="st">&quot;all&quot;</span>)
alldocs&lt;-alldocs <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">std_url =</span> <span class="kw">sub</span>(<span class="st">&quot;download/&quot;</span>, <span class="st">&quot;&quot;</span>, url))

docallocs&lt;-<span class="kw">get_allocation</span>(<span class="st">&quot;all&quot;</span>, <span class="dt">allocation_type =</span> <span class="st">&quot;coding&quot;</span>)

docallocs&lt;-<span class="kw">left_join</span>(docallocs, alldocs, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;document_id&quot;</span>=<span class="st">&quot;id&quot;</span>))

classdocs&lt;-<span class="kw">filter</span>(docallocs, coding_complete<span class="op">==</span><span class="dv">1</span>, electoralviolence_nature <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;false&quot;</span>, <span class="st">&quot;true&quot;</span>))
classdocs&lt;-classdocs <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">std_url =</span> <span class="kw">sub</span>(<span class="st">&quot;download/&quot;</span>, <span class="st">&quot;&quot;</span>, url)) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">unclass=</span><span class="dv">0</span>, <span class="dt">classified=</span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">EV_article=</span><span class="kw">ifelse</span>(electoralviolence_nature<span class="op">==</span><span class="st">&quot;true&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>))


systematic_search_terms&lt;-<span class="kw">c</span>(<span class="st">&quot;incident&quot;</span>,
                           <span class="st">&quot;riot&quot;</span>,
                           <span class="st">&quot;mob&quot;</span>,
                           <span class="st">&quot;rough&quot;</span>,
                           <span class="st">&quot;disturbance&quot;</span>,
                           <span class="st">&quot;husting&quot;</span>,
                           <span class="st">&quot;adjourn&quot;</span>,
                           <span class="st">&quot;magistrate&quot;</span>,
                           <span class="st">&quot;police&quot;</span>,
                           <span class="st">&quot;prison&quot;</span>,
                           <span class="st">&quot;candidate&quot;</span>,
                           <span class="st">&quot;election&quot;</span>,
                           <span class="st">&quot;party&quot;</span>)
all_searches&lt;-<span class="kw">get_archivesearches</span>()
systematic_searches&lt;-all_searches<span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(id, search_text, archive_date_start, archive_date_end) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(search_text <span class="op">%in%</span><span class="st"> </span>systematic_search_terms)

results_systematic_searches&lt;-<span class="kw">get_archivesearchresults</span>(<span class="dt">archive_search_id =</span> systematic_searches<span class="op">$</span>id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(all_searches, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;archive_search_id&quot;</span>=<span class="st">&quot;id&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">std_url =</span> <span class="kw">sub</span>(<span class="st">&quot;download/&quot;</span>, <span class="st">&quot;&quot;</span>, url))


is_classified &lt;-results_systematic_searches<span class="op">$</span>std_url <span class="op">%in%</span><span class="st"> </span>classdocs<span class="op">$</span>std_url

classified_results&lt;-results_systematic_searches[is_classified,]</code></pre></div>
</div>
<div id="train-keyword-classifier" class="section level2">
<h2>Train Keyword Classifier</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">class_res_dfm&lt;-durhamevp<span class="op">::</span><span class="kw">searches_to_dfm</span>(classified_results)
the_urls&lt;-quanteda<span class="op">::</span><span class="kw">docvars</span>(class_res_dfm, <span class="st">&quot;std_url&quot;</span>)
ordered_cr&lt;-classified_results[<span class="kw">match</span>(quanteda<span class="op">::</span><span class="kw">docvars</span>(class_res_dfm, <span class="st">&quot;std_url&quot;</span>), classified_results<span class="op">$</span>std_url),]

summary_class &lt;-<span class="st"> </span>classdocs <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(std_url, document_id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">EV_article=</span>electoralviolence_nature<span class="op">==</span><span class="st">&quot;true&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">EV_article=</span><span class="kw">max</span>(EV_article), <span class="dt">sum_EV_article=</span><span class="kw">sum</span>(EV_article), <span class="dt">n=</span><span class="kw">n</span>())

ordered_classified&lt;-summary_class[<span class="kw">match</span>(quanteda<span class="op">::</span><span class="kw">docvars</span>(class_res_dfm, <span class="st">&quot;std_url&quot;</span>), summary_class<span class="op">$</span>std_url),]

quanteda<span class="op">::</span><span class="kw">docvars</span>(class_res_dfm, <span class="st">&quot;EV_article&quot;</span>)&lt;-ordered_classified<span class="op">$</span>EV_article

<span class="co"># use 85 per cent of the classified data to train classifier</span>
<span class="co"># the other 15 per cent are used to as the testing set</span>
n_train &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">nrow</span>(class_res_dfm)<span class="op">*</span>.<span class="dv">85</span>)
the_sets&lt;-<span class="kw">split_dfm</span>(class_res_dfm, <span class="dt">n_train =</span> n_train)
testing_urls&lt;-quanteda<span class="op">::</span><span class="kw">docvars</span>(the_sets<span class="op">$</span>testing_set, <span class="st">&quot;std_url&quot;</span>)
training_urls&lt;-quanteda<span class="op">::</span><span class="kw">docvars</span>(the_sets<span class="op">$</span>training_set, <span class="st">&quot;std_url&quot;</span>)

<span class="co"># train xgboost keyword classifier</span>
classifier&lt;-durhamevp<span class="op">::</span><span class="kw">evp_classifiers</span>(the_sets<span class="op">$</span>training_set, <span class="st">&quot;xgboost&quot;</span>, <span class="st">&quot;EV_article&quot;</span>, <span class="st">&quot;uniform&quot;</span>)

<span class="co"># train naive bayes keyword classifier</span>
classifier_nb&lt;-durhamevp<span class="op">::</span><span class="kw">evp_classifiers</span>(the_sets<span class="op">$</span>training_set, <span class="st">&quot;nb&quot;</span>, <span class="st">&quot;EV_article&quot;</span>, <span class="st">&quot;uniform&quot;</span>)</code></pre></div>
</div>
<div id="evaluate-classifier-on-test-set" class="section level2">
<h2>Evaluate Classifier on Test Set</h2>
<p>Note this step should be regularly implemented to check that performance of classifier is improving not degrading. However, it is not necessary for the process.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># add predictions to the training and testing sets</span>
quanteda<span class="op">::</span><span class="kw">docvars</span>(the_sets<span class="op">$</span>training_set, <span class="st">&quot;predicted_keywords&quot;</span>)&lt;-<span class="kw">predict</span>(classifier, <span class="dt">newdata =</span> the_sets<span class="op">$</span>training_set, <span class="dt">type=</span><span class="st">&quot;class&quot;</span>)
quanteda<span class="op">::</span><span class="kw">docvars</span>(the_sets<span class="op">$</span>testing_set, <span class="st">&quot;predicted_keywords&quot;</span>)&lt;-<span class="kw">predict</span>(classifier, <span class="dt">newdata =</span> the_sets<span class="op">$</span>testing_set, <span class="dt">type=</span><span class="st">&quot;class&quot;</span>)
quanteda<span class="op">::</span><span class="kw">docvars</span>(the_sets<span class="op">$</span>testing_set, <span class="st">&quot;predicted_keywords_nb&quot;</span>)&lt;-<span class="kw">predict</span>(classifier_nb, <span class="dt">newdata =</span> the_sets<span class="op">$</span>testing_set, <span class="dt">type=</span><span class="st">&quot;prob&quot;</span>)[,<span class="dv">2</span>]

quanteda<span class="op">::</span><span class="kw">docvars</span>(the_sets<span class="op">$</span>testing_set, <span class="st">&quot;pred_class_keywords&quot;</span>)&lt;-<span class="kw">factor</span>(<span class="kw">as.numeric</span>(quanteda<span class="op">::</span><span class="kw">docvars</span>(the_sets<span class="op">$</span>testing_set, <span class="st">&quot;predicted_keywords&quot;</span>)<span class="op">&gt;</span>.<span class="dv">5</span>))

results_table&lt;-<span class="kw">as.data.frame.matrix</span>(caret<span class="op">::</span><span class="kw">confusionMatrix</span>(<span class="dt">data=</span>quanteda<span class="op">::</span><span class="kw">docvars</span>(the_sets<span class="op">$</span>testing_set, <span class="st">&quot;pred_class_keywords&quot;</span>), <span class="dt">reference=</span><span class="kw">factor</span>(quanteda<span class="op">::</span><span class="kw">docvars</span>(the_sets<span class="op">$</span>testing_set, <span class="st">&quot;EV_article&quot;</span>)), <span class="dt">mode=</span><span class="st">&quot;prec_recall&quot;</span>, <span class="dt">positive=</span><span class="st">&quot;1&quot;</span>)<span class="op">$</span>table)

## **** probably delete****
tmp_train&lt;-quanteda<span class="op">::</span><span class="kw">docvars</span>(the_sets<span class="op">$</span>training_set)
p1&lt;-<span class="kw">ggplot</span>(tmp_train, <span class="kw">aes</span>(predicted_keywords, EV_article))<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">position=</span><span class="kw">position_jitter</span>(<span class="dt">height=</span>.<span class="dv">1</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method=</span><span class="st">&quot;glm&quot;</span>, <span class="dt">method.args =</span> <span class="kw">list</span>(<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;performance of the xgboost keyword classifier on the training set&quot;</span>)

tmp_test&lt;-quanteda<span class="op">::</span><span class="kw">docvars</span>(the_sets<span class="op">$</span>testing_set)
p2&lt;-<span class="kw">ggplot</span>(tmp_test, <span class="kw">aes</span>(predicted_keywords, EV_article))<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">position=</span><span class="kw">position_jitter</span>(<span class="dt">height=</span>.<span class="dv">1</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method=</span><span class="st">&quot;glm&quot;</span>, <span class="dt">method.args =</span> <span class="kw">list</span>(<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;performance of the xgboost keyword classifier on the testing set&quot;</span>)
p2

p3&lt;-<span class="kw">ggplot</span>(tmp_test, <span class="kw">aes</span>(predicted_keywords_nb, EV_article))<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">position=</span><span class="kw">position_jitter</span>(<span class="dt">height=</span>.<span class="dv">1</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method=</span><span class="st">&quot;glm&quot;</span>, <span class="dt">method.args =</span> <span class="kw">list</span>(<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;performance of the naive bayes keyword classifier on the testing set&quot;</span>)
<span class="kw">print</span>(p3)
p4&lt;-<span class="kw">ggplot</span>(tmp_test, <span class="kw">aes</span>(<span class="dt">y=</span>EV_article))<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">colour=</span><span class="st">&quot;red&quot;</span>, <span class="dt">position=</span><span class="kw">position_jitter</span>(<span class="dt">height=</span>.<span class="dv">1</span>), <span class="kw">aes</span>(<span class="dt">x=</span>predicted_keywords_nb))<span class="op">+</span>
<span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method=</span><span class="st">&quot;glm&quot;</span>,<span class="dt">colour=</span><span class="st">&quot;red&quot;</span>,  <span class="dt">method.args =</span> <span class="kw">list</span>(<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>), <span class="kw">aes</span>(<span class="dt">x=</span>predicted_keywords_nb))<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">colour=</span><span class="st">&quot;green&quot;</span>, <span class="dt">position=</span><span class="kw">position_jitter</span>(<span class="dt">height=</span>.<span class="dv">1</span>), <span class="kw">aes</span>(<span class="dt">x=</span>predicted_keywords))<span class="op">+</span>
<span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method=</span><span class="st">&quot;glm&quot;</span>,<span class="dt">colour=</span><span class="st">&quot;green&quot;</span>,  <span class="dt">method.args =</span> <span class="kw">list</span>(<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>), <span class="kw">aes</span>(<span class="dt">x=</span>predicted_keywords))<span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;performance of the naive bayes keyword classifier on the testing set&quot;</span>)</code></pre></div>
</div>
<div id="use-classifier-on-unclassified-cases" class="section level1">
<h1>Use Classifier on Unclassified Cases</h1>
<p>We do not examine status 1 or status 3 documents.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">undownloaded_candidates&lt;-<span class="kw">get_candidate_documents</span>(<span class="dt">status =</span><span class="kw">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;6&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;&quot;</span>), <span class="dt">include_ocr=</span><span class="ot">FALSE</span>)
undownloaded_candidates&lt;-<span class="st"> </span>undownloaded_candidates <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">std_url =</span> <span class="kw">sub</span>(<span class="st">&quot;download/&quot;</span>, <span class="st">&quot;&quot;</span>, url))

need_classifying &lt;-results_systematic_searches<span class="op">$</span>std_url <span class="op">%in%</span><span class="st"> </span>undownloaded_candidates<span class="op">$</span>std_url

toclassify_results&lt;-results_systematic_searches[need_classifying,]

toclass_res_dfm&lt;-durhamevp<span class="op">::</span><span class="kw">searches_to_dfm</span>(toclassify_results)
classify_urls&lt;-quanteda<span class="op">::</span><span class="kw">docvars</span>(toclass_res_dfm, <span class="st">&quot;std_url&quot;</span>)

toclass_othervars &lt;-<span class="st"> </span>toclassify_results <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(newspaper_title, publication_date, publication_location, type, std_url) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(std_url,newspaper_title, publication_date, publication_location, type) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span> ()

ordered_tcov&lt;-toclass_othervars[<span class="kw">match</span>(quanteda<span class="op">::</span><span class="kw">docvars</span>(toclass_res_dfm, <span class="st">&quot;std_url&quot;</span>), toclass_othervars<span class="op">$</span>std_url),]

quanteda<span class="op">::</span><span class="kw">docvars</span>(toclass_res_dfm, <span class="st">&quot;publication_date&quot;</span>)&lt;-ordered_tcov<span class="op">$</span>publication_date
quanteda<span class="op">::</span><span class="kw">docvars</span>(toclass_res_dfm, <span class="st">&quot;publication_location&quot;</span>)&lt;-ordered_tcov<span class="op">$</span>publication_location
quanteda<span class="op">::</span><span class="kw">docvars</span>(toclass_res_dfm, <span class="st">&quot;newspaper_title&quot;</span>)&lt;-ordered_tcov<span class="op">$</span>newspaper_title
quanteda<span class="op">::</span><span class="kw">docvars</span>(toclass_res_dfm, <span class="st">&quot;type&quot;</span>)&lt;-ordered_tcov<span class="op">$</span>type

<span class="co"># this step reorders the dfm to have the columns in the same order as the training_set dfm</span>
toclass_res_dfm&lt;-quanteda<span class="op">::</span><span class="kw">dfm_select</span>(toclass_res_dfm, the_sets<span class="op">$</span>training_set)

<span class="co"># this step actually implements the prediction</span>
quanteda<span class="op">::</span><span class="kw">docvars</span>(toclass_res_dfm, <span class="st">&quot;predicted_keywords&quot;</span>)&lt;-<span class="kw">predict</span>(classifier, <span class="dt">newdata =</span> toclass_res_dfm, <span class="dt">type=</span><span class="st">&quot;class&quot;</span>)</code></pre></div>
</div>
<div id="from-document-feature-matrix-results-to-candidate-documents-results" class="section level1">
<h1>From Document Feature Matrix Results to Candidate Documents Results</h1>
<p>The results set contains many references to the same document (perhaps with different descriptions). The next step is to identify the unique candidate documents which these results relate to. Add the classification (where this is a subset the classification is always 1)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">undownloaded_candidates_with_kwpred&lt;-<span class="kw">left_join</span>(undownloaded_candidates, quanteda<span class="op">::</span><span class="kw">docvars</span>(toclass_res_dfm), <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;std_url&quot;</span>, <span class="st">&quot;publication_date&quot;</span>, <span class="st">&quot;publication_location&quot;</span>, <span class="st">&quot;type&quot;</span>))

<span class="co"># add election name</span>
undownloaded_candidates_with_kwpred&lt;-undownloaded_candidates_with_kwpred <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(publication_date) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">election_name=</span><span class="kw">date_to_election</span>(publication_date)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">right_join</span>(undownloaded_candidates_with_kwpred, <span class="dt">by=</span><span class="st">&quot;publication_date&quot;</span>)

##  If working by election subset to 1874 (or other desired election)

kwclass_<span class="dv">1874</span>&lt;-undownloaded_candidates_with_kwpred <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(election_name<span class="op">==</span><span class="st">&quot;1874&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="op">-</span>predicted_keywords)

<span class="kw">hist</span>(kwclass_<span class="dv">1874</span><span class="op">$</span>predicted_keywords)


kwclass_1874_top5000&lt;-kwclass_<span class="dv">1874</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5000</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(id, url, publication_title, description, status, g_status, title, status_writer, predicted_keywords)
  
kwclass_1874_top5000<span class="op">$</span>status&lt;-<span class="dv">1</span>
kwclass_1874_top5000<span class="op">$</span>status_writer&lt;-<span class="st">&quot;xgboost_keyword&quot;</span></code></pre></div>
<div id="save-results" class="section level2">
<h2>Save results</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">to_csv&lt;-kwclass_1874_top5000[,<span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;url&quot;</span>, <span class="st">&quot;publication_title&quot;</span>, <span class="st">&quot;description&quot;</span>, <span class="st">&quot;status&quot;</span>, <span class="st">&quot;g_status&quot;</span>, <span class="st">&quot;title&quot;</span>, <span class="st">&quot;status_writer&quot;</span>, <span class="st">&quot;predicted_keywords&quot;</span>)]

csv_filename&lt;-<span class="kw">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;_&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;britishnewspaperarchive_&quot;</span>, <span class="kw">format</span>(<span class="kw">Sys.time</span>(), <span class="st">&quot;%Y_%m_%d_%H_%M_%S&quot;</span>), <span class="st">&quot;.csv&quot;</span>))

<span class="kw">write.csv</span>(to_csv, <span class="dt">file=</span>csv_filename, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</code></pre></div>
</div>
<div id="some-more-evaluation-code" class="section level2">
<h2>Some more evaluation code</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
top_ones&lt;-quanteda<span class="op">::</span><span class="kw">docvars</span>(toclass_res_dfm, <span class="st">&quot;predicted_keywords&quot;</span>)<span class="op">&gt;</span>.<span class="dv">9</span>
quanteda<span class="op">::</span><span class="kw">docvars</span>(toclass_res_dfm, <span class="st">&quot;std_url&quot;</span>)[top_ones][<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]

as_df&lt;-<span class="kw">as.tbl</span>(quanteda<span class="op">::</span><span class="kw">docvars</span>(toclass_res_dfm)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pubyear=</span>lubridate<span class="op">::</span><span class="kw">year</span>(publication_date))

<span class="co">#system.time(as_df &lt;- as_df %&gt;%</span>
<span class="co">#  mutate(election=date_to_election(publication_date)))</span>

as_df&lt;-as_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(publication_date) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">election_name=</span><span class="kw">date_to_election</span>(publication_date)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">right_join</span>(as_df, <span class="dt">by=</span><span class="st">&quot;publication_date&quot;</span>) 
pp1&lt;-as_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(election_dates, <span class="dt">by=</span><span class="st">&quot;election_name&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(keywords_13_complete<span class="op">==</span><span class="st">&quot;Y&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(election_name, predicted_keywords, <span class="dt">group=</span>election_name)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>()

pp1&lt;-as_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(election_dates, <span class="dt">by=</span><span class="st">&quot;election_name&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(keywords_13_complete<span class="op">==</span><span class="st">&quot;Y&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(election_name, predicted_keywords, <span class="dt">group=</span>election_name)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_violin</span>(<span class="dt">trim=</span><span class="ot">FALSE</span>)

as_df &lt;-<span class="st"> </span>as_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">electionn=</span><span class="kw">as.numeric</span>(election))

prob_class&lt;-<span class="cf">function</span>(x){
  <span class="kw">case_when</span>(
    x<span class="op">&gt;</span>.<span class="dv">75</span> <span class="op">~</span><span class="st"> &quot;highly likely (&gt;.75)&quot;</span>,
    x<span class="op">&gt;</span>.<span class="dv">5</span>  <span class="op">~</span><span class="st"> &quot;likely (&gt;.5 &amp; &lt;.75)&quot;</span>,
    x<span class="op">&gt;</span>.<span class="dv">25</span> <span class="op">~</span><span class="st"> &quot;unlikely (&lt;.5 &amp; &gt;.25)&quot;</span>,
    x<span class="op">&lt;</span>.<span class="dv">25</span> <span class="op">~</span><span class="st"> &quot;very unlikely(&lt;.25)&quot;</span>,
    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="ot">NA_character_</span>
  )
}
pp4&lt;-as_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prob_EV_keywords=</span><span class="kw">prob_class</span>(predicted_keywords)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">electionn=</span><span class="kw">as.numeric</span>(election_name)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(electionn<span class="op">&lt;</span><span class="dv">1875</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(election_name, electionn, prob_EV_keywords) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tally</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(electionn, n))<span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>prob_EV_keywords, <span class="dt">scales=</span><span class="st">&quot;free&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="ot">NA</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Number of Currently Undownloaded Articles in Each Election by EV_Article Likelihood (Keyword Classifier)&quot;</span>)

pp2&lt;-as_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(electionn) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tally</span>()<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(electionn, n)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()
pp2

<span class="kw">dim</span>(results_systematic_searches)
rss&lt;-results_systematic_searches <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(publication_date) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">election_name=</span><span class="kw">date_to_election</span>(publication_date)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">right_join</span>(results_systematic_searches, <span class="dt">by=</span><span class="st">&quot;publication_date&quot;</span>)
pp3&lt;-rss <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(election_name, search_text) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tally</span>()<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">electionn=</span><span class="kw">as.numeric</span>(election_name)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(durhamevp<span class="op">::</span>election_dates, <span class="dt">by=</span><span class="st">&quot;election_name&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">articles_per_day=</span>n<span class="op">/</span>monthsearch_duration) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(keywords_13_complete<span class="op">==</span><span class="st">&quot;Y&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(electionn, articles_per_day)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>search_text, <span class="dt">scales=</span><span class="st">&quot;free&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="ot">NA</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Articles (per day) Containing 13 Systematic Search Terms During Month Around Elections&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()
pp3
<span class="co">#link to searchers</span>

candocs&lt;-<span class="kw">get_candidate_documents</span>(<span class="dt">status =</span><span class="kw">c</span>(<span class="st">&quot;0&quot;</span>,<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;6&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;8&quot;</span>), <span class="dt">include_ocr=</span><span class="ot">FALSE</span>)

candocs&lt;-candocs <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">std_url =</span> <span class="kw">sub</span>(<span class="st">&quot;download/&quot;</span>, <span class="st">&quot;&quot;</span>, url))
candocs<span class="op">$</span>EV_article&lt;-<span class="kw">ifelse</span>(candocs<span class="op">$</span>g_status <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;3&quot;</span>), <span class="dv">1</span>, <span class="dv">0</span>)


candocs_training_set&lt;-candocs[<span class="op">!</span>candocs<span class="op">$</span>std_url <span class="op">%in%</span><span class="st"> </span>testing_urls, ]
candocs_testing_set&lt;-candocs[candocs<span class="op">$</span>std_url <span class="op">%in%</span><span class="st"> </span>testing_urls, ]
descript_test&lt;-classified_results[classified_results<span class="op">$</span>std_url <span class="op">%in%</span><span class="st"> </span>testing_urls,]

select_descript_xgb&lt;-<span class="kw">classifier_selection_description</span>(candocs_training_set, descript_test, <span class="dt">classifier_type=</span><span class="st">&quot;xgboost&quot;</span>, <span class="dt">return_logical =</span> <span class="ot">TRUE</span>, <span class="dt">logical_to_prob=</span><span class="ot">TRUE</span>, <span class="dt">stem=</span><span class="ot">FALSE</span>, <span class="dt">min_docfreq=</span><span class="dv">20</span>, <span class="dt">min_termfreq=</span><span class="dv">20</span>)

descript_test &lt;-<span class="st"> </span>descript_test <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">xgb_select=</span>select_descript_xgb)

compare_docs&lt;-descript_test<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(candocs_testing_set, <span class="dt">by=</span><span class="st">&quot;description&quot;</span>)

<span class="kw">table</span>(compare_docs<span class="op">$</span>xgb_select<span class="op">&gt;</span>.<span class="dv">5</span>, compare_docs<span class="op">$</span>g_status)

<span class="kw">ggplot</span>(compare_docs, <span class="kw">aes</span>(xgb_select, <span class="kw">as.numeric</span>(g_status<span class="op">==</span><span class="dv">1</span>)))<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">position=</span><span class="st">&quot;jitter&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method=</span><span class="st">&quot;glm&quot;</span>, <span class="dt">method.args =</span> <span class="kw">list</span>(<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Performance of the xgboost descrition classifier on the testing set&quot;</span>)

compare_docs&lt;-descript_test<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(std_url) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">maxselect=</span><span class="kw">max</span>(xgb_select)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(candocs_testing_set, <span class="dt">by=</span><span class="st">&quot;std_url&quot;</span>)

check_descript_xgb&lt;-<span class="kw">classifier_selection_description</span>(candocs_training_set, candocs_training_set, <span class="dt">classifier_type=</span><span class="st">&quot;xgboost&quot;</span>, <span class="dt">return_logical =</span> <span class="ot">TRUE</span>, <span class="dt">logical_to_prob=</span><span class="ot">TRUE</span>, <span class="dt">stem=</span><span class="ot">FALSE</span>, <span class="dt">min_docfreq=</span><span class="dv">50</span>, <span class="dt">min_termfreq=</span><span class="dv">50</span>)

descript_test &lt;-<span class="st"> </span>candocs_training_set <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">xgb_select=</span>check_descript_xgb)

compare_docs&lt;-descript_test<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(candocs_training_set, <span class="dt">by=</span><span class="st">&quot;description&quot;</span>)

<span class="kw">table</span>(compare_docs<span class="op">$</span>xgb_select<span class="op">&gt;</span>.<span class="dv">5</span>, compare_docs<span class="op">$</span>g_status.x)

<span class="kw">ggplot</span>(compare_docs, <span class="kw">aes</span>(xgb_select, <span class="kw">as.numeric</span>(g_status.x<span class="op">==</span><span class="st">&quot;1&quot;</span>)))<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">position=</span><span class="st">&quot;jitter&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method=</span><span class="st">&quot;glm&quot;</span>, <span class="dt">method.args =</span> <span class="kw">list</span>(<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Performance of the xgboost descrition classifier on the training set&quot;</span>)</code></pre></div>
</div>
<div id="view-classification-results" class="section level2">
<h2>View classification results</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">documents_to_latex</span>(<span class="kw">sample_n</span>(select_descript_xgb, <span class="dv">30</span>), <span class="dt">include_ocr=</span><span class="ot">FALSE</span>, <span class="dt">pandoc_output=</span><span class="ot">TRUE</span>)</code></pre></div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
